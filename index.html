<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="js/alpine.js" defer></script>
      <script src="js/tooltip.js"></script>
      <script src="js/input.js"></script>
      <script src="js/main.js"></script>
      <script src="js/toast.js"></script>
      <link rel="stylesheet" href="css/main.css">
      <link rel="stylesheet" href="css/md.css">
      <link rel="shortcut icon" href="assets/diamond.png" type="image/x-icon">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
         rel="stylesheet">
      <title>Nilmoni</title>
   </head>
   <body>
      <div x-data="main()" class="stroke-gray-400 overflow-hidden">
         <div class="bg-srone-50 height-dvh flex">
            <!-- modal -->
            <div @keydown.escape.window="modal = false" :class="{ 'z-40': modal }" class="relative w-auto h-auto">
               <template x-teleport="body">
                  <div x-show="modal"
                     class="fixed top-0 left-0 z-[99] flex items-center justify-center w-screen h-screen" x-cloak>
                     <div x-show="modal" x-transition:enter="ease-out duration-200"
                        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                        x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
                        x-transition:leave-end="opacity-0" @click="modal=false"
                        class="absolute inset-0 w-full h-full bg-white/50 backdrop-blur-xs"></div>
                     <div x-show="modal" x-transition:enter="ease-out duration-200"
                        x-transition:enter-start="opacity-0 -translate-y-4 sm:scale-95"
                        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                        x-transition:leave="ease-in duration-100"
                        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                        x-transition:leave-end="opacity-0 translate-y-4 sm:scale-95"
                        class="relative bg-white shadow-xl border border-neutral-200 sm:w-auto min-w-80 max-w-xl rounded-xl overflow-hidden transition-all">
                        <!-- content -->
                        <div x-show="modalContent == 'settings'"
                           class="min-h-96 max-w-[40rem] h-[32rem] sm:h-96 w-[calc(100vw-2rem)]">
                           <button @click="modal=false"
                              class="absolute top-0 right-0 flex items-center justify-center w-8 h-8 mt-2 mr-2 text-gray-600 rounded-full hover:text-gray-800 hover:bg-gray-50">
                           <i data-lucide="x"></i>
                           </button>
                           <div x-data="{ tab: 'general',  tabs: { 'general': 'globe', 'advanced': 'settings', 'appearance': 'eye'} }"
                              class="flex flex-col sm:flex-row h-full">
                              <div
                                 class="w-full sm:w-48 sm:h-full h-auto bg-gray-50 sm:border-r border-b sm:border-b-0 border-neutral-200 p-4 pt-12 flex flex-col gap-2">
                                 <template x-for="(icon, t) in tabs" :key="t">
                                    <button @click="tab = t"
                                       class="w-full flex items-center gap-3 p-2 rounded-lg hover:bg-white border border-gray-50 transition"
                                       :class="{ 'bg-white border-neutral-200': tab == t }">
                                    <i :data-lucide="icon" class="w-5 h-5"></i>
                                    <span class="text-sm text-gray-700 capitalize" x-text="t"></span>
                                    </button>
                                 </template>
                              </div>
                              <div class="flex-1 h-full px-4 py-6 sm:py-8 overflow-y-auto scrollbar-thin">
                                 <div x-show="tab == 'general'">
                                    <p for="" class="text-gray-500 text-xs">Language</p>
                                    <div x-data="{ 
                                       open: false,
                                       options: ['English', 'Bangla', 'Hindi'],
                                       selected: 'English',
                                       }" class="relative mt-1">
                                       <div @click="open = !open"
                                          class="btn py-1.5 px-2 w-40 flex items-center mt-2">
                                          <div class="flex items-center justify-between w-full">
                                             <span x-text="selected" class="font-normal"></span>
                                             <i data-lucide="chevron-down" class="w-4 h-4 ml-2"></i>
                                          </div>
                                       </div>
                                       <!-- dropdown -->
                                       <div x-show="open" @click.outside="open=false" x-transition
                                          class="absolute left-0 mt-2 p-1 w-40 bg-white border border-neutral-200 rounded-lg overflow-hidden shadow-lg z-50"
                                          style="display: none;">
                                          <template x-for="option in options" :key="option">
                                             <button @click="open=false; selected=option"
                                                class="w-full text-left px-3 py-2 rounded-md text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50 active:bg-gray-100 flex items-center justify-between">
                                             <span x-text="option"></span>
                                             <i data-lucide="check" x-show="selected == option"
                                                class="w-4 h-4 stroke-blue-500"
                                                style="display: none;"></i>
                                             </button>
                                          </template>
                                       </div>
                                    </div>
                                 </div>
                                 <div x-show="tab == 'appearance'">
                                    <p for="" class="text-gray-500 text-xs">Theme</p>
                                    <div x-data="{ open: false, options: ['Light', 'Dark'], selected: 'Light' }"
                                       class="relative mt-1">
                                       <div @click="open = !open"
                                          class="btn py-1.5 px-2 w-40 flex items-center mt-2">
                                          <div class="flex items-center justify-between w-full">
                                             <span x-text="selected" class="font-normal"></span>
                                             <i data-lucide="chevron-down" class="w-4 h-4 ml-2"></i>
                                          </div>
                                       </div>
                                       <!-- dropdown -->
                                       <div x-show="open" @click.outside="open=false" x-transition
                                          class="absolute left-0 mt-2 p-1 w-40 bg-white border border-neutral-200 rounded-lg overflow-hidden shadow-lg z-50"
                                          style="display: none;">
                                          <template x-for="option in options" :key="option">
                                             <button @click="open=false; selected=option"
                                                class="w-full text-left px-3 py-2 rounded-md text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50 active:bg-gray-100 flex items-center justify-between">
                                             <span x-text="option"></span>
                                             <i data-lucide="check" x-show="selected == option"
                                                class="w-4 h-4 stroke-blue-500"
                                                style="display: none;"></i>
                                             </button>
                                          </template>
                                       </div>
                                    </div>
                                 </div>
                                 <div x-show="tab == 'advanced'">
                                    <p for="" class="text-gray-500 text-xs">Model</p>
                                    <div x-data="{ open: false, options: ['GPT-3.5', 'GPT-4'], selected: 'GPT-3.5' }"
                                       class="relative mt-1">
                                       <div @click="open = !open"
                                          class="btn py-1.5 px-2 w-40 flex items-center mt-2">
                                          <div class="flex items-center justify-between w-full">
                                             <span x-text="selected" class="font-normal"></span>
                                             <i data-lucide="chevron-down" class="w-4 h-4 ml-2"></i>
                                          </div>
                                       </div>
                                       <!-- dropdown -->
                                       <div x-show="open" @click.outside="open=false" x-transition
                                          class="absolute left-0 mt-2 p-1 w-40 bg-white border border-neutral-200 rounded-lg overflow-hidden shadow-lg z-50"
                                          style="display: none;">
                                          <template x-for="option in options" :key="option">
                                             <button @click="open=false; selected=option"
                                                class="w-full text-left px-3 py-2 rounded-md text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50 active:bg-gray-100 flex items-center justify-between">
                                             <span x-text="option"></span>
                                             <i data-lucide="check" x-show="selected == option"
                                                class="w-4 h-4 stroke-blue-500"
                                                style="display: none;"></i>
                                             </button>
                                          </template>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div x-show="modalContent == 'rename'" class="flex flex-col p-6 w-80 sm:w-96">
                           <h4 class="mb-4"><i data-lucide="info"
                              class="w-4 h-4 stroke-neutral-900 inline-block mr-2"></i>Rename chat</h4>
                           <input type="text" id="chatName" placeholder="Chat name"
                              class="w-full border border-neutral-300 rounded-lg px-3 py-2 mb-6 focus:outline-none focus:ring-2 focus:ring-neutral-200">
                           <div class="flex items-center justify-end gap-4">
                              <div @click="modal = false" class="btn rounded-full">
                                 Cancel
                              </div>
                              <div @click="modal = false; window.toast('Chat renamed!', { type: 'success' })" class="btn btn-black rounded-full">
                                 Rename
                              </div>
                           </div>
                        </div>
                        <div x-show="modalContent == 'share'" class="flex flex-col p-6 w-80 sm:w-96">
                           <h4 class="mb-4"><i data-lucide="share-2"
                              class="w-4 h-4 stroke-neutral-900 inline-block mr-2"></i>Share this chat</h4>
                           <input type="text" id="shareLink" value="https://example.com/chat/123"
                              class="w-full border border-neutral-300 bg-neutral-50 rounded-lg px-3 py-2 mb-6 focus:outline-none focus:ring-2 focus:ring-neutral-200"
                              disabled>
                           <div class="flex items-center justify-end gap-4">
                              <div @click="modal = false" class="btn rounded-full">
                                 Cancel
                              </div>
                              <div @click="modal = false" class="btn btn-black rounded-full">
                                 <i data-lucide="copy" class="w-4 h-4 stroke-white inline-block mr-2"></i>Copy
                              </div>
                           </div>
                        </div>
                        <div x-show="modalContent == 'confirm'" class="flex flex-col p-6 w-80 sm:w-96">
                           <h4 class="mb-4"><i data-lucide="info"
                              class="w-4 h-4 stroke-red-500 inline-block mr-2"></i>Delete chat?</h4>
                           <p class="mb-6 text-gray-500">Lorem ipsum dolor sit amet consectetur adipisicing elit.
                              Officiis, assumenda?
                           </p>
                           <div class="flex items-center justify-end gap-4">
                              <div @click="modal = false" class="btn rounded-full">
                                 Cancel
                              </div>
                              <div @click="modal = false; window.toast('Chat deleted!', { type: 'success' })" class="btn btn-red rounded-full">
                                 Delete
                              </div>
                           </div>
                        </div>
                        <div x-show="modalContent == 'upload-alert'" class="flex flex-col p-6 w-80 sm:w-96">
                           <h4 class="mb-4"><i data-lucide="file-x"
                              class="w-4 h-4 stroke-red-500 inline-block mr-2"></i>Can't upload</h4>
                           <p class="mb-6 text-gray-500">You can upload only 3 file in Free plane. <span
                              @click="modal=true; modalContent='plans'" class="link">Upgrade plane</span> to
                              upload more
                           </p>
                           <div class="flex items-center justify-end gap-4">
                              <div @click="modal = false" class="btn rounded-full">
                                 Cancel
                              </div>
                              <div @click="modal=true; modalContent='plans'" class="btn btn-blue rounded-full">
                                 Upgrade
                              </div>
                           </div>
                        </div>
                        <div x-show="modalContent == 'plans'" class="flex flex-col p-6 w-80 sm:w-96">
                           <h2 class="text-3xl font-semibold text-center text-neutral-900 mb-4">Topper <span
                              class="text-black underline">Plan</span></h2>
                           <!-- pricing -->
                           <div class="flex items-center justify-center">
                              <div class="flex items-center gap-2">
                                 <span class="text-3xl font-medium text-neutral-900">৳500</span>
                                 <span class="text-sm text-neutral-500">/ month</span>
                              </div>
                           </div>
                           <!-- features -->
                           <div class="mt-4 p-4">
                              <ul class="list-inside">
                                 <li><i data-lucide="check" class="inline stroke-blue-500 mr-3"></i>More
                                    accurate responses
                                 </li>
                                 <li><i data-lucide="check" class="inline stroke-blue-500 mr-3"></i>Access to
                                    advanced models
                                 </li>
                                 <li><i data-lucide="check" class="inline stroke-blue-500 mr-3"></i>50 Chat per
                                    day
                                 </li>
                              </ul>
                           </div>
                           <button @click="modal = false" class="btn btn-black rounded-full py-2 px-5 text-lg font-medium m-6">Get
                           started</button>
                        </div>
                     </div>
                  </div>
               </template>
            </div>
            <!-- toast -->
            <ul 
               x-data="{ 
                  toasts: [],
                  toastsHovered: false,
                  expanded: false,
                  layout: 'default',
                  position: 'top-center',
                  paddingBetweenToasts: 15,
                  deleteToastWithId (id){
                     for(let i = 0; i < this.toasts.length; i++){
                           if(this.toasts[i].id === id){
                              this.toasts.splice(i, 1);
                              break;
                           }
                     }
                  },
                  burnToast(id){
                     burnToast = this.getToastWithId(id);
                     burnToastElement = document.getElementById(burnToast.id);
                     if(burnToastElement){
                           if(this.toasts.length == 1){
                              if(this.layout=='default'){
                                 this.expanded = false;
                              }
                              burnToastElement.classList.remove('translate-y-0');
                              if(this.position.includes('bottom')){
                                 burnToastElement.classList.add('translate-y-full');
                              } else {
                                 burnToastElement.classList.add('-translate-y-full');
                              }
                              burnToastElement.classList.add('-translate-y-full');
                           }
                           burnToastElement.classList.add('opacity-0');
                           let that = this;
                           setTimeout(function(){
                              that.deleteToastWithId(id);
                              setTimeout(function(){
                                 that.stackToasts();
                              }, 1)
                           }, 300);
                     }
                  },
                  getToastWithId(id){
                     for(let i = 0; i < this.toasts.length; i++){
                           if(this.toasts[i].id === id){
                              return this.toasts[i];
                           }
                     }
                  },
                  stackToasts(){
                     this.positionToasts();
                     this.calculateHeightOfToastsContainer();
                     let that = this;
                     setTimeout(function(){
                           that.calculateHeightOfToastsContainer();
                     }, 300);
                  },
                  positionToasts(){
                     if(this.toasts.length == 0) return;
                     let topToast = document.getElementById( this.toasts[0].id );
                     topToast.style.zIndex = 100;
                     if(this.expanded){
                           if(this.position.includes('bottom')){
                              topToast.style.top = 'auto';
                              topToast.style.bottom = '0px';
                           } else {
                              topToast.style.top = '0px';
                           }
                     }

                     let bottomPositionOfFirstToast = this.getBottomPositionOfElement(topToast);

                     if(this.toasts.length == 1) return;
                     let middleToast = document.getElementById( this.toasts[1].id );
                     middleToast.style.zIndex = 90;

                     if(this.expanded){
                           middleToastPosition = topToast.getBoundingClientRect().height +
                                                   this.paddingBetweenToasts + 'px';

                           if(this.position.includes('bottom')){
                              middleToast.style.top = 'auto';
                              middleToast.style.bottom = middleToastPosition;
                           } else {
                              middleToast.style.top = middleToastPosition;
                           }

                           middleToast.style.scale = '100%';
                           middleToast.style.transform = 'translateY(0px)';
                           
                     } else {
                           middleToast.style.scale = '94%';
                           if(this.position.includes('bottom')){
                              middleToast.style.transform = 'translateY(-16px)';
                           } else {
                              this.alignBottom(topToast, middleToast);
                              middleToast.style.transform = 'translateY(16px)';
                           }
                     }
                     

                     if(this.toasts.length == 2) return;
                     let bottomToast = document.getElementById( this.toasts[2].id );
                     bottomToast.style.zIndex = 80;
                     if(this.expanded){
                           bottomToastPosition = topToast.getBoundingClientRect().height + 
                                                   this.paddingBetweenToasts + 
                                                   middleToast.getBoundingClientRect().height +
                                                   this.paddingBetweenToasts + 'px';
                           
                           if(this.position.includes('bottom')){
                              bottomToast.style.top = 'auto';
                              bottomToast.style.bottom = bottomToastPosition;
                           } else {
                              bottomToast.style.top = bottomToastPosition;
                           }

                           bottomToast.style.scale = '100%';
                           bottomToast.style.transform = 'translateY(0px)';
                     } else {
                           bottomToast.style.scale = '88%';
                           if(this.position.includes('bottom')){
                              bottomToast.style.transform = 'translateY(-32px)';
                           } else {
                              this.alignBottom(topToast, bottomToast);
                              bottomToast.style.transform = 'translateY(32px)';
                           }
                     }

                     

                     if(this.toasts.length == 3) return;
                     let burnToast = document.getElementById( this.toasts[3].id );
                     burnToast.style.zIndex = 70;
                     if(this.expanded){
                           burnToastPosition = topToast.getBoundingClientRect().height + 
                                                   this.paddingBetweenToasts + 
                                                   middleToast.getBoundingClientRect().height + 
                                                   this.paddingBetweenToasts + 
                                                   bottomToast.getBoundingClientRect().height + 
                                                   this.paddingBetweenToasts + 'px';
                           
                           if(this.position.includes('bottom')){
                              burnToast.style.top = 'auto';
                              burnToast.style.bottom = burnToastPosition;
                           } else {
                              burnToast.style.top = burnToastPosition;
                           }

                           burnToast.style.scale = '100%';
                           burnToast.style.transform = 'translateY(0px)';
                     } else {
                           burnToast.style.scale = '82%';
                           this.alignBottom(topToast, burnToast);
                           burnToast.style.transform = 'translateY(48px)';
                     }

                     burnToast.firstElementChild.classList.remove('opacity-100');
                     burnToast.firstElementChild.classList.add('opacity-0');

                     let that = this;
                     // Burn 🔥 (remove) last toast
                     setTimeout(function(){
                              that.toasts.pop();
                           }, 300);

                     if(this.position.includes('bottom')){
                              middleToast.style.top = 'auto';
                     }

                     return;
                  },
                  alignBottom(element1, element2) {
                     // Get the top position and height of the first element
                     let top1 = element1.offsetTop;
                     let height1 = element1.offsetHeight;

                     // Get the height of the second element
                     let height2 = element2.offsetHeight;

                     // Calculate the top position for the second element
                     let top2 = top1 + (height1 - height2);

                     // Apply the calculated top position to the second element
                     element2.style.top = top2 + 'px';
                  },
                  alignTop(element1, element2) {
                     // Get the top position of the first element
                     let top1 = element1.offsetTop;

                     // Apply the same top position to the second element
                     element2.style.top = top1 + 'px';
                  },
                  resetBottom(){
                     for(let i = 0; i < this.toasts.length; i++){
                           if(document.getElementById( this.toasts[i].id )){
                              let toastElement = document.getElementById( this.toasts[i].id );
                              toastElement.style.bottom = '0px';
                           }
                     }
                  },
                  resetTop(){
                     for(let i = 0; i < this.toasts.length; i++){
                           if(document.getElementById( this.toasts[i].id )){
                              let toastElement = document.getElementById( this.toasts[i].id );
                              toastElement.style.top = '0px';
                           }
                     }
                  },
                  getBottomPositionOfElement(el){
                     return (el.getBoundingClientRect().height + el.getBoundingClientRect().top);
                  },
                  calculateHeightOfToastsContainer(){
                     if(this.toasts.length == 0){
                           $el.style.height = '0px';
                           return;
                     }

                     lastToast = this.toasts[this.toasts.length - 1];
                     lastToastRectangle = document.getElementById(lastToast.id).getBoundingClientRect();
                     
                     firstToast = this.toasts[0];
                     firstToastRectangle = document.getElementById(firstToast.id).getBoundingClientRect();

                     if(this.toastsHovered){
                           if(this.position.includes('bottom')){
                              $el.style.height = ((firstToastRectangle.top + firstToastRectangle.height) - lastToastRectangle.top) + 'px';
                           } else {
                              $el.style.height = ((lastToastRectangle.top + lastToastRectangle.height) - firstToastRectangle.top) + 'px';
                           }
                     } else {
                           $el.style.height = firstToastRectangle.height + 'px';
                     }
                  }
               }"
               @set-toasts-layout.window="
                  layout=event.detail.layout;
                  if(layout == 'expanded'){
                     expanded=true;
                  } else {
                     expanded=false;
                  }
                  stackToasts();
               "
               @toast-show.window="
                  event.stopPropagation();
                  if(event.detail.position){
                     position = event.detail.position;
                  }
                  toasts.unshift({
                     id: 'toast-' + Math.random().toString(16).slice(2),
                     show: false,
                     message: event.detail.message,
                     description: event.detail.description,
                     type: event.detail.type,
                     html: event.detail.html
                  });
               "
               @mouseenter="toastsHovered=true;"
               @mouseleave="toastsHovered=false"
               x-init="
                  if(layout == 'expanded'){
                     expanded = true;
                  }
                  stackToasts();
                  $watch('toastsHovered', function(value){

                     if(layout == 'default'){
                           if(position.includes('bottom')){
                              resetBottom();
                           } else {
                              resetTop();
                           }

                           if(value){
                              // calculate the new positions
                              expanded = true;
                              if(layout == 'default'){
                                 stackToasts();
                              }
                           } else {
                              if(layout == 'default'){
                                 expanded = false;
                                 //setTimeout(function(){
                                 stackToasts();
                              //}, 10);
                                 setTimeout(function(){
                                       stackToasts();
                                 }, 10)
                              }
                           }
                     }
                  });
               "
               class="fixed block w-full group z-[99] sm:max-w-xs"
               :class="{ 'right-0 top-0 sm:mt-6 sm:mr-6': position=='top-right', 'left-0 top-0 sm:mt-6 sm:ml-6': position=='top-left', 'left-1/2 -translate-x-1/2 top-0 sm:mt-6': position=='top-center', 'right-0 bottom-0 sm:mr-6 sm:mb-6': position=='bottom-right', 'left-0 bottom-0 sm:ml-6 sm:mb-6': position=='bottom-left', 'left-1/2 -translate-x-1/2 bottom-0 sm:mb-6': position=='bottom-center' }"
               x-cloak>
         
               <template x-for="(toast, index) in toasts" :key="toast.id">
                  <li
                     :id="toast.id"
                     x-data="{
                           toastHovered: false
                     }"
                     x-init=" () => {
                        if(position.includes('bottom')){
                           $el.firstElementChild.classList.add('toast-bottom');
                           $el.firstElementChild.classList.add('opacity-0', 'translate-y-full');
                        } else {
                           $el.firstElementChild.classList.add('opacity-0', '-translate-y-full');
                        }
                        setTimeout(function(){
                           
                           setTimeout(function(){
                              if(position.includes('bottom')){
                                    $el.firstElementChild.classList.remove('opacity-0', 'translate-y-full');
                              } else {
                                    $el.firstElementChild.classList.remove('opacity-0', '-translate-y-full');
                              }
                              $el.firstElementChild.classList.add('opacity-100', 'translate-y-0');

                              setTimeout(function(){
                                    stackToasts();
                              }, 10);
                           }, 5);
                        }, 50);
      
                        setTimeout(function(){
                           setTimeout(function(){
                              $el.firstElementChild.classList.remove('opacity-100');
                              $el.firstElementChild.classList.add('opacity-0');
                              if(toasts.length == 1){
                                    $el.firstElementChild.classList.remove('translate-y-0');
                                    $el.firstElementChild.classList.add('-translate-y-full');
                              }
                              setTimeout(function(){
                                    deleteToastWithId(toast.id)
                              }, 300);
                           }, 5);
                        }, 4000);
                     }"
                     @mouseover="toastHovered=true"
                     @mouseout="toastHovered=false"
                     class="absolute w-full duration-300 ease-out select-none sm:max-w-xs"
                     :class="{ 'toast-no-description': !toast.description }"
                     >
                     <span 
                           class="relative flex flex-col items-start shadow-[0_5px_15px_-3px_rgb(0_0_0_/_0.08)] w-full transition-all duration-300 ease-out bg-white border border-gray-100 sm:rounded-md sm:max-w-xs group"
                           :class="{ 'p-4' : !toast.html, 'p-0' : toast.html }"
                     >
                           <template x-if="!toast.html">
                              <div class="relative">
                                 <div class="flex items-center stroke-none"
                                       :class="{ 'text-green-500' : toast.type=='success', 'text-blue-500' : toast.type=='info', 'text-orange-400' : toast.type=='warning', 'text-red-500' : toast.type=='danger', 'text-gray-800' : toast.type=='default' }">
                                       
                                       <svg x-show="toast.type=='success'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM16.7744 9.63269C17.1238 9.20501 17.0604 8.57503 16.6327 8.22559C16.2051 7.87615 15.5751 7.93957 15.2256 8.36725L10.6321 13.9892L8.65936 12.2524C8.24484 11.8874 7.61295 11.9276 7.248 12.3421C6.88304 12.7566 6.92322 13.3885 7.33774 13.7535L9.31046 15.4903C10.1612 16.2393 11.4637 16.1324 12.1808 15.2547L16.7744 9.63269Z" fill="currentColor"></path></svg>
                                       <svg x-show="toast.type=='info'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 9C12.5523 9 13 8.55228 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55228 11.4477 9 12 9ZM13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12V16C11 16.5523 11.4477 17 12 17C12.5523 17 13 16.5523 13 16V12Z" fill="currentColor"></path></svg>
                                       <svg x-show="toast.type=='warning'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.44829 4.46472C10.5836 2.51208 13.4105 2.51168 14.5464 4.46401L21.5988 16.5855C22.7423 18.5509 21.3145 21 19.05 21L4.94967 21C2.68547 21 1.25762 18.5516 2.4004 16.5862L9.44829 4.46472ZM11.9995 8C12.5518 8 12.9995 8.44772 12.9995 9V13C12.9995 13.5523 12.5518 14 11.9995 14C11.4473 14 10.9995 13.5523 10.9995 13V9C10.9995 8.44772 11.4473 8 11.9995 8ZM12.0009 15.99C11.4486 15.9892 11.0003 16.4363 10.9995 16.9886L10.9995 16.9986C10.9987 17.5509 11.4458 17.9992 11.9981 18C12.5504 18.0008 12.9987 17.5537 12.9995 17.0014L12.9995 16.9914C13.0003 16.4391 12.5532 15.9908 12.0009 15.99Z" fill="currentColor"></path></svg>
                                       <svg x-show="toast.type=='danger'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM11.9996 7C12.5519 7 12.9996 7.44772 12.9996 8V12C12.9996 12.5523 12.5519 13 11.9996 13C11.4474 13 10.9996 12.5523 10.9996 12V8C10.9996 7.44772 11.4474 7 11.9996 7ZM12.001 14.99C11.4488 14.9892 11.0004 15.4363 10.9997 15.9886L10.9996 15.9986C10.9989 16.5509 11.446 16.9992 11.9982 17C12.5505 17.0008 12.9989 16.5537 12.9996 16.0014L12.9996 15.9914C13.0004 15.4391 12.5533 14.9908 12.001 14.99Z" fill="currentColor"></path></svg>
                                       <p class="text-[13px] font-medium leading-none text-gray-800" x-text="toast.message"></p>
                                 </div>
                                 <p x-show="toast.description" 
                                       :class="{ 'pl-5' : toast.type!='default' }"
                                       class="mt-1.5 text-xs leading-none opacity-70" x-text="toast.description"></p>
                              </div>
                           </template>
                           <template x-if="toast.html">
                              <div x-html="toast.html"></div>
                           </template>
                           <span 
                              @click="burnToast(toast.id)"
                              class="absolute right-0 p-1.5 mr-2.5 text-gray-400 duration-100 ease-in-out rounded-full opacity-0 cursor-pointer hover:bg-gray-50 hover:text-gray-500"
                              :class="{ 'top-1/2 -translate-y-1/2' : !toast.description && !toast.html, 'top-0 mt-2.5' : (toast.description || toast.html), 'opacity-100' : toastHovered, 'opacity-0' : !toastHovered }"
                           >
                              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                           </span>
                     </span>
                  </li>
               </template>
            </ul>
            <div @keydown.escape.window="sidebar = false" @click="sidebar = false" x-show="sidebar"
               class="md:hidden absolute inset-0 w-full h-full bg-white/50 backdrop-blur-xs z-20"
               style="display: none;">
            </div>
            <aside
               class="absolute w-0 overflow-hidden md:static flex flex-col bg-white h-full border-r border-gray-300 z-30 transition-all duration-200"
               :class="{ 'w-0': !sidebar, 'w-64': sidebar }">
               <a href="/">
                  <div class="flex items-center p-4 gap-2">
                     <img src="assets/diamond.png" alt="Nilmoni logo"
                        width="28" height="28">
                     <h2 class="text-xl text-neutral-900 text-nowrap font-semibold">Nilmoni</h2>
                  </div>
               </a>
               <div> <button @click="selectedConversation=null; closeSidebar()"
                  class="mx-3 w-auto flex items-center justify-center gap-2 p-2 pr-4 hover:bg-gray-100 active:bg-gray-200 rounded-full text-sm">
                  <i data-lucide="pen-line"
                     class="w-4 h-4"></i><span
                     class="text-gray-600 text-sm text-nowrap">New chat</span>
                  </button> 
               </div>
               <div class="flex-1 px-3 mt-4 overflow-y-auto scrollbar-thin">
                  <p class="text-gray-400 text-sm mb-4 ml-3 text-nowrap">All Chats</p>
                  <div class="flex flex-col gap-2">
                     <template x-for="conversation in conversations" :key="conversation.id">
                        <div x-data="{ open: false }"
                           class="group relative items-center rounded-full hover:bg-gray-50 cursor-pointer active:bg-gray-100 flex transition-all">
                           <p @click="selectedConversation = conversation.id; closeSidebar()" x-text="conversation.title" class="flex-1 pl-3 py-2 text-sm text-gray-700 line-clamp-1"></p>
                           <button @click="open = !open"
                              class="md:hidden cursor-pointer w-7 h-7 m-1 group-hover:flex flex items-center justify-center bg-white hover:bg-gray-50 border ring-offset-2 focus:ring-2 focus:ring-neutral-200 border-neutral-200 rounded-full">
                           <i data-lucide="ellipsis" class="w-4 h-4"></i> </button> <!-- dropdown -->
                           <div x-show="open" @click.outside="open=false" x-transition.scale.50.origin.top.right.opacity
                              class="absolute right-0 top-10 p-1 w-32 bg-white border border-neutral-200 rounded-xl overflow-hidden shadow-lg z-50"
                              style="display: none;"> <button
                              @click="open=false; modal = true; modalContent = 'rename'"
                              class="w-full text-left px-2.5 py-1.5 rounded-md text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50">
                              <i data-lucide="edit" class="w-4 h-4 inline-block mr-2"></i> Rename </button>
                              <button @click="open=false; modal = true; modalContent = 'confirm'"
                                 class="w-full text-left px-2.5 py-1.5 rounded-lg text-sm text-red-600 hover:text-red-700 hover:bg-gray-50">
                              <i data-lucide="trash-2" class="w-4 h-4 inline-block mr-2 stroke-current"></i>
                              Delete </button>
                           </div>
                        </div>
                     </template>
                  </div>
               </div>
               <div class="relative m-2" x-data="{ open: false }">
                  <div @click="open = !open"
                     class="p-2 rounded-xl bg-neutral-50 hover:bg-gray-100 cursor-pointer flex items-center justify-between select-none">
                     <div class="flex items-center">
                        <img class="w-10 h-10 rounded-full mr-2 object-cover"
                           src="https://api.dicebear.com/9.x/notionists-neutral/svg?seed=George" alt="">
                        <div>
                           <h4 class="font-medium text-gray-700 line-clamp-1 -mb-1">Mohin Uddin</h4>
                           <span class="text-blue-500 text-xs text-nowrap">Topper</span>
                        </div>
                     </div>
                     <i data-lucide="chevrons-up-down"></i>
                  </div>
                  <!-- dropdown -->
                  <div x-show="open" @click.outside="open=false" x-transition.scale.90.origin.bottom.opacity
                     class="absolute right-0 bottom-18 mt-2 p-1 w-60 bg-white border border-neutral-200 rounded-xl overflow-hidden shadow-lg z-50"
                     style="display: none;">
                     <div class="px-3 py-2 text-gray-800 text-sm">name@email.com</div>
                     <div class="border-t border-neutral-200 m-1"></div>
                     <button
                        @click="open=false; modal = true; modalContent='plans' "
                        class="w-full text-left px-3 py-2 rounded-lg text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50">
                     <i data-lucide="circle-fading-arrow-up" class="w-4 h-4 inline-block mr-2"></i> Upgrade Plan
                     </button> <button @click="open=false; modal = true; modalContent='settings'"
                        class="w-full text-left px-3 py-2 rounded-lg text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50">
                     <i data-lucide="settings" class="w-4 h-4 inline-block mr-2"></i> Settings </button>
                     <div class="border-t border-neutral-200 m-1"></div>
                     <button
                        class="w-full text-left px-3 py-2 rounded-lg text-sm text-red-600 hover:text-red-700 hover:bg-gray-50">
                     <i data-lucide="log-out" class="w-4 h-4 inline-block mr-2 stroke-current"></i> Logout
                     </button>
                  </div>
               </div>
            </aside>
            <main class="flex flex-col height-dvh flex-1 relative">
               <header
                  class="relative w-full p-3 flex items-center justify-between border-b border-white transition-all duration-300 bg-white">
                  <div class="flex items-center gap-2">
                     <button @click="sidebar = !sidebar" class="btn border-none p-2"
                        :class="{ 'cursor-w-resize': sidebar}">
                     <i x-show="!sidebar" data-lucide="panel-left"></i>
                     <i x-show="sidebar" data-lucide="panel-left-close"></i>
                     </button>
                  </div>
                  <a href="/" class="text-xl text-neutral-900 font-semibold" x-show="!sidebar && selectedConversation != null">Nilmoni</a>
                  <div x-show="selectedConversation != null" x-data="{ open: false }" class="flex items-center gap-0 relative">
                     <button @click="open = !open" class="btn p-2 border-none">
                     <i data-lucide="ellipsis" class="w-5 h-5 stroke-gray-500"></i>
                     </button>
                     <!-- dropdown -->
                     <div x-show="open" @click.outside="open=false" x-transition.scale.50.origin.top.right.opacity
                        class="absolute right-2 top-9 mt-2 p-1 w-36 bg-white border border-neutral-200 rounded-xl overflow-hidden shadow-lg z-50"
                        style="display: none;">
                        <button @click="open=false; selectedConversation=null; closeSidebar()"
                           class="w-full text-left px-3 py-2 rounded-lg text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50">
                        <i data-lucide="pen-line" class="w-4 h-4 inline-block mr-2"></i>
                        New chat
                        </button>
                        <button @click="open=false; modal = true; modalContent='share'"
                           class="w-full text-left px-3 py-2 rounded-lg text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50">
                        <i data-lucide="Share" class="w-4 h-4 inline-block mr-2"></i>
                        Share
                        </button>
                        <button @click="open=false; modal = true; modalContent = 'confirm'"
                           class="w-full text-left px-3 py-2 rounded-lg text-sm text-red-600 hover:text-red-700 hover:bg-gray-50">
                        <i data-lucide="trash-2" class="w-4 h-4 inline-block mr-2 stroke-current"></i>
                        Delete
                        </button>
                     </div>
                  </div>
                  <div x-show="selectedConversation == null">
                     <button @click="modal = true; modalContent = 'plans'"
                        class="btn btn-blue border-dashed rounded-full">
                     <i data-lucide="circle-fading-arrow-up" class="w-4 h-4 inline-block mr-2 !stroke-blue-600"></i> Upgrade
                     </button>
                  </div>
               </header>
               <!-- messages container -->
               <div x-show="selectedConversation != null" id="chat" class="flex-1 w-full overflow-y-auto pb-4 scrollbar">
                  <div class="max-w-[46rem] mx-auto text-gray-800 mb-96">
                     <div class="space-y-8 pt-8 p-4">
                        <template x-for="message in currentMessages()" :key="message.id">
                           <div>
                              <div x-show="message.role == 'assistant'">
                                 <div class="markdown-body">
                                    <div :id="'reply-' + message.id" x-html="message.content"></div>
                                 </div>
                                 <div x-show="!isLoading && !isTyping" x-data="replyActions()" class="flex items-center justify-between gap-2 mt-4 mb-8">
                                    <div class="flex items-center sm:gap-2">
                                       <button
                                          @click="copied(); navigator.clipboard.writeText(document.getElementById('reply-' + message.id).innerText)"
                                          x-tooltip="Copy"
                                          class="btn btn-circle border-transparent ring-transparent"><i
                                          x-show="!copy" data-lucide="copy" class="w-4 h-4"></i><i
                                          x-show="copy" data-lucide="copy-check"
                                          class="w-4 h-4 stroke-blue-500"></i></button>
                                       <button @click="like = !like; dislike = false" x-tooltip="Like"
                                          class="btn btn-circle border-transparent ring-transparent"><i
                                          data-lucide="thumbs-up" class="w-4 h-4"
                                          :class="{'stroke-blue-500': like}"></i></button>
                                       <button @click="dislike = !dislike; like = false" x-tooltip="Dislike"
                                          class="btn btn-circle border-transparent ring-transparent"><i
                                          data-lucide="thumbs-down" class="w-4 h-4"
                                          :class="{'stroke-red-500': dislike}"></i></button>
                                       <div x-show="currentMessages().at(-1).id === message.id" class="flex items-center gap-2">
                                          
                                          <button @click="modal = true; modalContent = 'share'" x-tooltip="Share"
                                             class="btn btn-circle border-transparent ring-transparent"><i
                                             data-lucide="share" class="w-4 h-4"></i></button>
                                       </div>
                                    </div>

                                 </div>
                              </div>
                              <div x-show="message.role == 'user'" class="flex items-end gap-2">
                                 <div
                                    class="max-w-lg inline-block bg-gray-100 py-2 px-4 rounded-[18px] rounded-tl-sm font-sans mr-6">
                                    <p x-text="message.content"></p>
                                 </div>
                                 <div class="flex items-center justify-end" x-show="currentMessages().filter(m => m.role === 'user')[-1]?.id === message.id">
                                    <button @click="" x-tooltip="Edit"
                                       class="btn btn-circle border-transparent ring-transparent"><i
                                       data-lucide="edit" class="w-4 h-4"></i></button>
                                    <button x-tooltip="Regenerate"
                                       class="btn btn-circle border-transparent ring-transparent"><i
                                       data-lucide="rotate-cw" class="w-4 h-4"></i></button>
                                 </div>
                              </div>
                           </div>
                        </template>
                              <div x-show="isLoading" class="p-2" style="display: none;">
                                 <img src="assets/loading.svg" alt="">
                              </div>
                     </div>
                  </div>
               </div>
               <div x-show="selectedConversation == null" class="flex-1 w-full overflow-hidden flex flex-col items-center justify-end gap-8 mb-40 px-4">
                  <div class="flex flex-col items-center justify-center gap-4">
                     <img src="assets/diamond.png" alt="Nilmoni logo" width="64" height="64">
                     <h1 class="text-2xl font-semibold text-neutral-900">Nilmoni</h1>
                     <p class="text-gray-700 text-center text-lg">How can I help you today?</p>
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <template x-for="card in cards">
                        <div @click="prompt = card.prompt; selectedTool = tools.find(tool => tool.id == card.tool)"
                           class="cursor-pointer select-none hover:bg-gray-50 active:bg-gray-100 transition-all p-3 max-w-80 border-2 rounded-xl border-dashed border-gray-200 ">
                           <div class="flex items-center gap-2 mb-1">
                              <i :data-lucide="card.icon" class="w-4 h-4 stroke-gray-600 inline"></i>
                              <h3 class="font-semibold text-gray-600" x-text="card.title"></h3>
                           </div>
                           <p class="text-sm line-clamp-1 text-gray-500" x-text="card.prompt"></p>
                        </div>
                     </template>
                  </div>
               </div>
               <!-- input container -->
               <div x-data="{ 
                     resize () { 
                        const field = this.$refs.promptField;
                        field.style.height = '0px'; 
                        field.style.height = field.scrollHeight + 'px' 
                     } 
                  }"
                  class="input-container-gradient w-full p-3 pt-8 max-w-[48rem] mx-auto absolute bottom-0 left-1/2 -translate-x-1/2">
                  <div
                     class="bg-white shadow-[0_4px_12px_rgba(0,0,0,0.05)] border border-neutral-300 rounded-3xl p-3 w-full flex flex-col gap-2">
                     <div class="w-full">
                        <textarea x-ref="promptField" x-init="resize()" @input="resize()" @focus="resize()" @blur="resize()" @keydown.enter="submitPrompt(); prompt=''; $el.blur(); resize()" @click="$refs.generateButton && resize()" type="text"
                        id="prompt" x-model="prompt" placeholder="Ask me anything..."
                        class="flex w-full scrollbar-thin h-auto min-h-[36px] max-h-[200px] px-3 py-2 bg-white focus:outline-none focus:ring-0 resize-none"></textarea>
                     </div>
                     <div class="flex flex-col">
                        <div class="flex py-1">
                           <!-- files preview -->
                           <div class="flex flex-wrap items-center gap-1">
                              <template x-for="(f, i) in files" :key="f.id">
                                 <div x-init="lucide.createIcons()"
                                    class="flex items-center gap-1 bg-neutral-100 text-xs text-neutral-500 rounded-full px-2 mb-1">
                                    <div class="flex items-center gap-2">
                                       <i data-lucide="file" class="w-4 h-4"></i>
                                       <span x-text="f.name" class="max-w-[160px] truncate"></span>
                                       <button type="button" @click="removeFile(i)" class="ml-1"
                                          aria-label="Remove file">
                                       <span class="text-neutral-500 text-xl">&times;</span>
                                       </button>
                                    </div>
                                 </div>
                              </template>
                           </div>
                        </div>
                        <div class="flex items-end justify-between">
                           <div class="flex gap-3">
                              <div class="flex items-center gap-2 relative">
                                 <!-- attach file -->
                                 <input x-ref="fileInput" type="file" id="fileInput"
                                    accept="image/*,application/pdf,.txt" multiple class="hidden"
                                    @change="addFiles($event)">
                                 <button type="button" x-tooltip="Attach file" class="btn btn-circle"
                                    @click="$refs.fileInput.click()">
                                 <i data-lucide="plus" class="w-4 h-4"></i>
                                 </button>
                                 <!-- select tool -->
                                 <div class="relative">
                                    <button type="button" x-tooltip="Select toot"
                                       class="btn btn-circle flex gap-1.5 transition-transform max-w-[200px]"
                                       @click="showTools = true">
                                       <i data-lucide="settings-2" class="w-4 h-4"></i>
                                       <div x-show="selectedTool" class="flex items-center " x-transition>
                                          <span
                                             class="text-blue-500 font-normal text-sm my-[-2px] pl-1.5 border-l border-neutral-200 text-nowrap overflow-hidden"
                                             x-text="selectedTool?.name"></span>
                                          <div @click="selectedTool = null; setTimeout(() => { showTools = false }, 1)" 
                                             class="ml-2 flex items-center z-10" title="Remove tool">
                                             <i data-lucide="x" class="w-4 h-4 inline-block"></i>
                                          </div>
                                       </div>
                                    </button>
                                    <!-- dropdown -->
                                    <div x-show="showTools" @click.outside="showTools=false" 
                                       x-transition.scale.50.origin.bottom-left.opacity
                                       class="absolute origin-bottom-left left-0 bottom-10 mt-2 p-1 w-48 bg-white border border-neutral-200 rounded-xl overflow-hidden shadow-lg z-50"
                                       style="display: none;">
                                       <button
                                          @click="showTools=false; modal = true; modalContent = 'settings' "
                                          class="w-full text-left px-3 py-2 rounded-lg text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50">
                                       <i data-lucide="settings" class="w-4 h-4 inline-block mr-2"></i>
                                       Settings
                                       </button>
                                       <div class="border-t border-neutral-200 m-1"></div>
                                       <div>
                                          <template x-for="tool in tools" :key="tool.id">
                                             <button @click="selectedTool = tool; showTools=false;"
                                                class="w-full text-left px-3 py-2 rounded-md text-sm text-neutral-600 hover:text-neutral-800 hover:bg-gray-50">
                                             <i :data-lucide="tool.icon"
                                                class="w-4 h-4 inline-block mr-2"></i>
                                             <span x-text="tool.name"></span>
                                             </button>
                                          </template>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div x-tr:pop class="flex items-center gap-2">
                              <!-- enhance prompt -->
                              <button x-tooltip="Enhance prompt"
                                 class="btn btn-circle border-transparent ring-transparent w-9 h-8"><i
                                 data-lucide="stars" class="w-4 h-4"></i></button>
                              <!-- generate -->
                              <button x-tooltip="Generate/Stop (ctrl+enter)"
                                 x-ref="generateButton"
                                 id="generateButton"
                                 class="btn btn-black btn-circle ring-transparent w-9 h-9"
                                 :class="{'bg-neutral-100': isLoading || isTyping}"
                                 @click="submitPrompt();">
                              <i data-lucide="arrow-up" x-show="!isLoading && !isTyping" class="!stroke-white"></i>
                              <i data-lucide="loader" x-show="isLoading"
                                 class="animate-spin !stroke-neutral-800"></i>
                              <i data-lucide="square" x-show="isTyping"
                                 class="!stroke-red-600 w-4 h-4"></i>
                              </button>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </main>
         </div>
      </div>
      <script src="js/lucide.js"></script>
      <script>
         document.addEventListener('alpine:init', () => {
             Alpine.effect(() => {
                 Alpine.nextTick(() => {
                     lucide.createIcons();
                 });
             });
             setInterval(() => {
                 lucide.createIcons();
             }, 1000);
         });
         
      </script>
   </body>
</html>

